{% extends "index.html" %}

{%block principal %}

<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<link rel="stylesheet" type="text/css" href="/assets/css/pilha.css"/>
<main class="text-center bg_secundario">
	<h3 class="tx_primario">Fila Encadeada</h3>
	<div id="content" class="col-12">
		<div class="row">
			<div id="detalhes" class="col-lg-2 col-sm-12 border"><hr>
				<div id="obs">
					<p>Utilize os botões Enfileirar e Remover para interagir.</p>
				</div>
				<div id="botoesopc">
					<div class="btnopc">
							<label for="#visualizar">Visualização: </label>
						<input id="visualizacao" data-toggle="toggle" data-on="Frente" data-width="90" data-size="small" data-off="Completa" data-offstyle="info" type="checkbox" checked>
					</div>
				</div>

				<hr>
				<div id="atributos">
					<h5>Detalhes</h5>
					<label for="#tamanho">Tamanho: </label>
					<span id="tamanho" class="badge badge-light"> 0 </span><br>
					<label for="#cabeca">Frente: </label>
					<span id="cabeca" class="badge badge-light"> *** </span><br>
					<label for="#cauda">Cauda: </label>
					<span id="cauda" class="badge badge-light"> *** </span>
				</div><hr>
				<div id="interacao" class="col-12">
					<h5>Interagir</h5>
					<div class="row">
						<div class="col-6" style="margin-left: -5px;">
							<div id="entrada" class="caixa m-auto" title="Informe o valor da caixa">
								<input type="text" id="valor" placeholder="valor">
							</div>
						</div>
						<div class="col-6">
							<label for="#lblremovido">Removido: </label>
							<span id="lblremovido" class="badge badge-light"> * </span><br>
						</div>
					</div>
					<div class="row">
						<div class="col-6 nopadding">
							<button type="button" class="btn btn-info btn-sm" id="add">Enfileirar</button>
						</div>
						<div class="col-6 nopadding">
							<button type="button" class="btn btn-danger btn-sm" id="rmv">Remover</button>
						</div>
					</div>
				</div><hr>
			</div>
			<div id="animacao" class="col-lg-10 col-sm-12 border">
				<div id="apresentacao" class="col-12 nopadding"></div>
			</div>
		</div>
	</div>
</main>
<!-- Código em java Script que será transferido depois para um arquivo separado.-->
<script type="text/javascript">
	var No = function(conteudo, proximo, id) {
		this.id = id;
		this.conteudo = conteudo;
		this.proximo = proximo;
	}
	No.prototype.getId = function() {
		return this.id;
	}
	No.prototype.getConteudo = function() {
		return this.conteudo;
	}
	No.prototype.getProximo = function() {
		return this.proximo;
	}
	No.prototype.setProximo = function(proximo) {
		this.proximo = proximo;
	}
	var Lista = function() {
		this.cabeca = null;
		this.tamanho = 0;
	}

	Lista.prototype.getTamanho = function() {
		return this.tamanho;
	}

	Lista.prototype.vazia = function() {
		return (this.tamanho == 0);
	}
	Lista.prototype.buscaElemento = function(posicao){
		var auxNo = this.cabeca;
		var cont = 1;
		if (this.vazia() || posicao<1 || posicao>this.tamanho){
			return null;
		}
		while(cont < posicao){
			auxNo = auxNo.getProximo();
			cont++;
		}
		return auxNo;
	}
	Lista.prototype.inserir = function(posicao, conteudo, id) {
		var novoNo = new No(conteudo, null, id);
		if(posicao == 1){//insere no começo da lista
			novoNo.setProximo(this.cabeca);
			this.cabeca = novoNo;
		}else if(posicao == this.tamanho+1){//insere no fim da lista
			var auxNo = this.cabeca;
			while(auxNo.getProximo() != null){
				auxNo = auxNo.getProximo();
			}
			auxNo.setProximo(novoNo);
		}else{//insere no meio da lista
			var cont=1;
			var auxNo = this.cabeca;
			while(cont < posicao-1){
				auxNo = auxNo.getProximo();
				cont++;
			}
			novoNo.setProximo(auxNo.getProximo());
			auxNo.setProximo(novoNo);
		}
		this.tamanho++;
	}
	Lista.prototype.remover = function(posicao){
		var removido = this.cabeca;;
		if (posicao == 1){ //remove no inicio da lista
			this.cabeca = removido.getProximo();
		}else{ //remove em outro lugar da lista
			var anterior = this.cabeca;
			var cont = 1;
			while(cont <posicao-1){
				anterior = anterior.getProximo();
				cont++;
			}
			removido = anterior.getProximo();
			anterior.setProximo(removido.getProximo());
		}
		this.tamanho--;
		return removido;
	}
	
	function ligaBTN(){
		$('#add').prop('disabled', false);
		$('#rmv').prop('disabled', false);
	}

	function desligaBTN(){
		$('#add').prop('disabled', true);
		$('#rmv').prop('disabled', true);
	}

	function atualizaDetalhes(tamanho, inicio, fim, removido){
		$('#tamanho').html(" "+tamanho+" ");
		if(removido!=null){
			$('#lblremovido')[0].innerHTML = ' ' + removido + ' ';
		}
		if(inicio!=null){
			$('#cabeca').html(" "+inicio+" ");
		}
		if(fim!=null){
			$('#cauda').html(" "+fim+" ");
		}
	}

	function limpaDiv(id){
		$('#caixa'+id).hide("slow", function(){
			$('#caixa'+id).remove();
			ligaBTN();
			
			setUpVisualizacao();
			setUpVisualizacao();
		});
	}
	$(document).ready(function() {
		var listaE = new Lista();
		var divID = 0;
		var raiz;
		var add;
		$('.comeco').show("slow");
		$('#add').click(function() {
			if (listaE.getTamanho()>=100) {
				alert("Nem todo mundo é de ferro! Cansei por enquanto, que tal uma pausa?");
				$('#add').prop('disabled', true);
			}else{
				add = listaE.getTamanho();
				if (/^\d+$/.test($('#valor').val())){//verifica se a entrada é um número.
					raiz = $('#entrada').offset();
					desligaBTN();//desabilita os botões para que duas animação não aconteçam ao mesmo tempo.						
					listaE.inserir((listaE.getTamanho()+1), $('#valor').val(), divID);//posição, div:valor e id Adiciona ao fim da lista
					$('#apresentacao').append('<div id="caixa'+divID+'" class="float-left" style="position: absolute;"><div class="caixa float-left"><input type="text" value="'+$('#valor').val()+'" disabled></div><div class="comeco"></div></div>');//cria uma nova caixa para a simulação

                    destinoTopo=80*parseInt((add*110)/($('#apresentacao').width()-110));
                    destinoEsquerdo=parseInt(((add*110)%($('#apresentacao').width()-110))/110)*110;
					
					console.log(add++);console.log($('#apresentacao').width());
					$('#caixa'+divID).offset({top: raiz.top, left: raiz.left});//define a posição de origem da nova caixa
					//faz a animação até a posição correta, define a posição como estática, cria a ligação qua aponta para o próximo elemento e desabilita os botões.
					$('#caixa'+divID).animate({top: destinoTopo, left: destinoEsquerdo}, 1000, function(){
						$('#caixa'+divID++).css({"position": "static"});
						//$('#apresentacao').append('<div class="comeco"></div>');
						$('.comeco').show("slow");
						//Atualiza os detalhes só depois da animação.
						if(listaE.getTamanho() == 1){
							atualizaDetalhes(listaE.getTamanho(), $('#valor').val(), $('#valor').val(), null);
						}else{
							atualizaDetalhes(listaE.getTamanho(), null, $('#valor').val(), null);
						}
						ligaBTN();
						setUpVisualizacao();
						setUpVisualizacao();
					});
				}else{
					alert("Apenas números inteiros são permitidos.");
				}
			}
		});

		$('#rmv').click(function() {
			var removido;
			if(listaE.getTamanho()!=0){
				desligaBTN();
				removido = listaE.remover(1);
				limpaDiv(removido.getId());
			}
			if (listaE.getTamanho()!=0) {
				atualizaDetalhes(listaE.getTamanho(), listaE.buscaElemento(1).getConteudo(), listaE.buscaElemento(listaE.getTamanho()).getConteudo(), removido.getConteudo());
			}else{
				atualizaDetalhes(0, "***", "***", removido.getConteudo());
			}
		});


		$('#visualizacao').change(function() {
			setUpVisualizacao();
		});
	});




	function isBlurEnabled()
	{
		return $('#visualizacao').prop('checked');
	}

	function setUpVisualizacao()
	{
		var selector = "#apresentacao > div > .caixa";
		if (isBlurEnabled())
		{
			$('#cauda').addClass('caixa_blur');
			$(selector).addClass('caixa_blur');
			$(selector + ':eq(0)').removeClass('caixa_blur');
		}
		else
		{
			$(selector).removeClass('caixa_blur');
			$('#cauda').removeClass('caixa_blur');
		}
	}

</script>

{% endblock %}